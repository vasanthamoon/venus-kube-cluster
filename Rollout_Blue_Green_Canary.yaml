apiVersion: argoproj.io/v1
kind: Rollout
metadata:
  name: rollouts-app
  namaspace: devproject
  labels:
    app: rollouts-demo
spec:
  replicas: 5
  strategy:
    canary:
      steps:
      - setWeight: 20
      - pause: {}
      - setWeight: 40
      - pause: {duration: 10}
      - setWeight: 60
      - pause: {duration: 10}
      - setWeight: 80
      - pause: {duration: 10}
  revisionHistoryLimit: 2
  selector:
    matchLabels:
      app: rollouts-app
  template:
    metadata:
      labels:
        app: rollouts-app
    spec:
      containers:
        - image: sudarshanlnx/sundayweb2:v1
          name: webcon1
          imagePullPolicy: Always
          ports:
            - name: apache
              containerPort: 80
              protocol: TCP
          resources:
            requests:
              memory: "40Mi"
              cpu: "40m"
            limits:
              memory: "50Mi"
              cpu: "50m"
---
apiVersion: v1
kind: Service
metadata:
  name: websvc   #service name (it can be any name)
  namespace: devproject
spec:
  # type: LoadBalancer
  ports:
    - name: apache
      port: 80 #service port
      targetPort: 80 #container port
      protocol: TCP
  selector:     #mapping to pod
    app: rollouts-app
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: webingress
  namespace: devproject
spec:
  ingressClassName: nginx
  rules:
    - host: "www.projectsports.shop" # "www.wetechzone28.com"
      http:
        paths:
          - path: "/"
            pathType: Prefix
            backend:
              service:
                name: rollouts-demo
                port:
                number: 80
